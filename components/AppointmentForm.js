import { useState } from 'react'\nimport { useLang } from './LanguageProvider'\n\nexport default function AppointmentForm() {\n  const { t } = useLang()\n  const [status, setStatus] = useState(null) // null | 'loading' | 'success' | 'error'\n  const [errors, setErrors] = useState({})\n\n  function validate(values) {\n    const errs = {}\n    if (!values.fullName || values.fullName.trim().length < 2) {\n      errs.fullName = 'Please provide your full name'\n    }\n    if (!values.phone || !/^[+\d][\d\s-]{6,}$/.test(values.phone)) {\n      errs.phone = 'Please provide a valid phone number'\n    }\n    if (!values.age || isNaN(Number(values.age)) || Number(values.age) <= 0) {\n      errs.age = 'Please provide a valid age'\n    }\n    if (!values.datetime) {\n      errs.datetime = 'Please select a preferred date and time'\n    }\n    return errs\n  }\n\n  async function handleSubmit(e) {\n    e.preventDefault()\n    setStatus(null)\n    setErrors({})\n    const form = new FormData(e.target)\n    const values = Object.fromEntries(form.entries())\n\n    const validationErrors = validate(values)\n    if (Object.keys(validationErrors).length > 0) {\n      setErrors(validationErrors)\n      setTimeout(() => {\n        const selector = Object.keys(validationErrors)[0]\n        const el = document.querySelector(`[name="${selector}"]`)\n        if (el) {\n          el.focus()\n        }\n      }, 0)\n      return\n    }\n\n    setStatus('loading')\n    try {\n      const res = await fetch('/api/submit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(values)\n      })\n      if (res.ok) {\n        setStatus('success')\n        e.target.reset()\n        setErrors({})\n      } else {\n        setStatus('error')\n      }\n    } catch (err) {\n      setStatus('error')\n    }\n  }\n\n  return (\n    <div className="max-w-3xl mx-auto bg-white/90 backdrop-blur p-6 rounded shadow" role="region" aria-labelledby="appointmentFormHeading">\n      <h3 id="appointmentFormHeading" className="text-xl font-semibold mb-4">{t('form.title')}</h3>\n\n      <form onSubmit={handleSubmit} noValidate aria-describedby="formStatus">\n        <div className="grid grid-cols-1 gap-3">\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.fullName')}</span>\n            <input\n              name="fullName"\n              aria-invalid={errors.fullName ? 'true' : 'false'}\n              aria-describedby={errors.fullName ? 'err-fullName' : undefined}\n              required\n              className="input"\n            />\n            {errors.fullName && <span id="err-fullName" className="text-sm text-red-600 mt-1">{errors.fullName}</span>}\n          </label>\n\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.phone')}</span>\n            <input\n              name="phone"\n              aria-invalid={errors.phone ? 'true' : 'false'}\n              aria-describedby={errors.phone ? 'err-phone' : undefined}\n              required\n              inputMode="tel"\n              className="input"\n              placeholder="+20 10 1234 5678"\n            />\n            {errors.phone && <span id="err-phone" className="text-sm text-red-600 mt-1">{errors.phone}</span>}\n          </label>\n\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.email')}</span>\n            <input\n              name="email"\n              type="email"\n              aria-describedby="emailHelp"\n              className="input"\n              placeholder="you@example.com"\n            />\n            <span id="emailHelp" className="text-xs text-gray-500">Optional</span>\n          </label>\n\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.age')}</span>\n            <input\n              name="age"\n              type="number"\n              min="0"\n              aria-invalid={errors.age ? 'true' : 'false'}\n              aria-describedby={errors.age ? 'err-age' : undefined}\n              required\n              className="input"\n            />\n            {errors.age && <span id="err-age" className="text-sm text-red-600 mt-1">{errors.age}</span>}\n          </label>\n\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.reason')}</span>\n            <input name="reason" className="input" placeholder={t('form.reason')} />\n            <span className="text-xs text-gray-500">Optional</span>\n          </label>\n\n          <label className="flex flex-col">\n            <span className="text-sm font-medium">{t('form.datetime')}</span>\n            <input\n              name="datetime"\n              type="datetime-local"\n              aria-invalid={errors.datetime ? 'true' : 'false'}\n              aria-describedby={errors.datetime ? 'err-datetime' : undefined}\n              required\n              className="input"\n            />\n            {errors.datetime && <span id="err-datetime" className="text-sm text-red-600 mt-1">{errors.datetime}</span>}\n          </label>\n\n          <div>\n            <button\n              type="submit"\n              className="mt-2 bg-sky-600 text-white px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-400"\n              aria-disabled={status === 'loading'}\n            >\n              {t('form.submit')}\n            </button>\n          </div>\n\n          <div id="formStatus" className="mt-2" role="status" aria-live="polite">\n            {status === 'loading' && <div className="text-sm text-gray-600">Submittingâ€¦</div>}\n            {status === 'success' && <div className="text-sm text-green-600">Submitted successfully. Thank you!</div>}\n            {status === 'error' && <div className="text-sm text-red-600">Submission failed. Please try again later.</div>}\n          </div>\n        </div>\n      </form>\n    </div>\n  )\n}